<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ORLEN</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; background:black; }

/* MENU */
#menu {
position:absolute;
width:100%;
height:100%;
background:linear-gradient(to bottom, #000000, #1a0000);
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
color:white;
z-index:10;
}

#title {
font-size:80px;
letter-spacing:10px;
text-shadow:0 0 20px red;
margin-bottom:40px;
}

#playBtn {
padding:20px 50px;
font-size:22px;
cursor:pointer;
background:red;
border:none;
color:white;
}

#creditsBtn {
position:absolute;
right:40px;
bottom:40px;
padding:10px 20px;
cursor:pointer;
background:#222;
color:white;
border:1px solid red;
}

#creditsScreen {
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:none;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:15;
}

/* HUD */
#hud {
position:absolute;
top:20px;
left:20px;
color:white;
z-index:5;
display:none;
text-shadow:0 0 5px black;
font-size:18px;
}

#death {
position:absolute;
width:100%;
height:100%;
background:rgba(0,0,0,0.9);
color:white;
display:none;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:20;
}
</style>
</head>
<body>

<div id="menu">
<div id="title">ORLEN version alpha 0.2</div>
<button id="playBtn" onclick="startGame()">JOUER</button>
<button id="creditsBtn" onclick="showCredits()">CR√âDITS</button>
</div>

<div id="creditsScreen">
<h1>CR√âDITS</h1>
<p>Yotvin</p>
<button onclick="hideCredits()">Retour</button>
</div>

<div id="hud">
‚ù§Ô∏è Vie: <span id="hp">100</span><br>
üî´ Chargeur: <span id="mag">30</span> | R√©serve: <span id="reserve">90</span>
</div>

<div id="death">
<h1>üíÄ VOUS √äTES MORT</h1>
<button onclick="location.reload()">Rejouer</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

<script>
let scene, camera, renderer;
let enemies = [];
let health = 100;
let magazine = 30;
let reserveAmmo = 90;
let enemyHP = 5; // nombre de balles pour tuer
let isDead = false;

let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let yaw=0, pitch=0;

const playerHeight = 2;

function showCredits(){
document.getElementById("creditsScreen").style.display="flex";
}

function hideCredits(){
document.getElementById("creditsScreen").style.display="none";
}

function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("hud").style.display="block";
init();
animate();
}

function init(){
scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
camera.position.y = playerHeight;

renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.4));
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

// sol
const floor = new THREE.Mesh(
new THREE.PlaneGeometry(1000,1000),
new THREE.MeshStandardMaterial({color:0x111111})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// arme
const gun = new THREE.Mesh(
new THREE.BoxGeometry(0.6,0.3,1),
new THREE.MeshStandardMaterial({color:0x000000})
);
gun.position.set(0.6,-0.6,-1);
camera.add(gun);
scene.add(camera);

// spawn ennemis
for(let i=0;i<5;i++) spawnEnemy();

// souris
document.body.addEventListener("click", ()=>{
document.body.requestPointerLock();
});

document.addEventListener("mousemove", (e)=>{
if(document.pointerLockElement === document.body){
yaw -= e.movementX * 0.002;
pitch -= e.movementY * 0.002;
pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
camera.rotation.set(pitch, yaw, 0);
}
});

// clavier
document.addEventListener("keydown", (e)=>{
if(e.key=="z") moveForward=true;
if(e.key=="s") moveBackward=true;
if(e.key=="q") moveLeft=true;
if(e.key=="d") moveRight=true;

if(e.key=="r") reload();
});

document.addEventListener("keyup", (e)=>{
if(e.key=="z") moveForward=false;
if(e.key=="s") moveBackward=false;
if(e.key=="q") moveLeft=false;
if(e.key=="d") moveRight=false;
});

document.addEventListener("mousedown", shoot);
}

function spawnEnemy(){
let group = new THREE.Group();
group.userData.hp = enemyHP;

let body = new THREE.Mesh(
new THREE.BoxGeometry(3,6,2),
new THREE.MeshStandardMaterial({color:0x000000})
);
group.add(body);

for(let i=0;i<9;i++){
let eye = new THREE.Mesh(
new THREE.SphereGeometry(0.3),
new THREE.MeshStandardMaterial({color:0xff0000, emissive:0xff0000})
);
eye.position.set((i%3)-1, Math.floor(i/3)-1, 1.2);
group.add(eye);
}

group.position.set(Math.random()*200-100,3,Math.random()*200-100);
scene.add(group);
enemies.push(group);
}

function shoot(){
if(magazine<=0 || isDead) return;

magazine--;
updateAmmoUI();

let raycaster = new THREE.Raycaster();
raycaster.setFromCamera(new THREE.Vector2(0,0), camera);
let intersects = raycaster.intersectObjects(enemies,true);

if(intersects.length>0){
let enemy = intersects[0].object.parent;
enemy.userData.hp--;

enemy.children[0].material.color.set(0x550000); // flash rouge

setTimeout(()=>{
enemy.children[0].material.color.set(0x000000);
},100);

if(enemy.userData.hp <= 0){
scene.remove(enemy);
enemies.splice(enemies.indexOf(enemy),1);
spawnEnemy();
}
}
}

function reload(){
if(reserveAmmo<=0) return;
let needed = 30 - magazine;
let used = Math.min(needed, reserveAmmo);
magazine += used;
reserveAmmo -= used;
updateAmmoUI();
}

function updateAmmoUI(){
document.getElementById("mag").innerText=magazine;
document.getElementById("reserve").innerText=reserveAmmo;
}

function animate(){
requestAnimationFrame(animate);
if(isDead) return;

let speed = 0.5;
if(moveForward) camera.translateZ(-speed);
if(moveBackward) camera.translateZ(speed);
if(moveLeft) camera.translateX(-speed);
if(moveRight) camera.translateX(speed);

enemies.forEach(enemy=>{
enemy.lookAt(camera.position);
enemy.position.x += (camera.position.x - enemy.position.x)*0.002;
enemy.position.z += (camera.position.z - enemy.position.z)*0.002;

if(enemy.position.distanceTo(camera.position)<3){
health -= 0.2;
health = Math.max(0,health);
document.getElementById("hp").innerText=Math.floor(health);
if(health<=0){
isDead=true;
document.getElementById("death").style.display="flex";
}
}
});

renderer.render(scene,camera);
}
</script>

</body>
</html>
